<section id="simply-text-cursor" class="simply-section">
	<h1>*HTML Toolbar for Text Cursor*</h1>
	<div class="simply-toolbar">
		<ul class="simply-buttons">
			<li><button data-simply-section="simply-text-style" class="simply-expands"><i class="fa fa-magic"></i>Style</button></li>
			<!-- li><button data-simply-section="simply-text-class" class="simply-expands"><i class="fa fa-paint-brush"></i>Class</button></li -->
			<li><button data-simply-section="simply-text-align" class="simply-expands"><i class="fa fa-align-left"></i>Align</button></li>
			<li><button data-simply-section="simply-clipboard" class="simply-expands"><i class="fa fa-clipboard"></i>Clipboard</button></li>
			<li><button data-simply-section="simply-insert" class="simply-expands"><i class="fa fa-plus"></i>Insert</button></li>
		</ul>
		<div class="simply-toolbar-section simply-text-style">
			<ul>
				<li class="simply-text-format"><select name="textStyle" data-simply-action="simply-text-blockstyle">
					<option value="h1">Heading 1</option>
					<option value="h2">Heading 2</option>
					<option value="h3">Heading 3</option>
					<option value="p">Paragraph</option>
				</select></li>
				<li class="simply-text-bold"><button data-simply-action="simply-text-bold"><i class="fa fa-bold"></i>Bold</button></li>
				<li class="simply-text-italic"><button data-simply-action="simply-text-italic"><i class="fa fa-italic"></i>Italic</button></li>
				<li class="simply-text-underline"><button data-simply-action="simply-text-underline"><i class="fa fa-underline"></i>Underline</button></li>
				<li class="simply-text-code"><button data-simply-action="simply-text-code"><i class="fa fa-code"></i>[Code]</button></li>
			</ul>
		</div>
		<!-- div class="simply-toolbar-section simply-text-class">
			<ul data-type="simply-buttongroup-radio" style='display: inline-block;'>
				<li><button data-simply-action="simply-text-class" data-value="highlight"><i class="fa fa-sun-o"></i>Highlight</button></li>
				<li><button data-simply-action="simply-text-class" data-value="none"><i class="fa fa-times"></i>Default</button></li>
			</ul>
			<ul data-type="simply-buttongroup-radio" style='display: inline-block;'>
				<li><button data-simply-action="simply-text-class" data-value="blue"><i class="fa fa-paint-brush"></i>Blue</button></li>
				<li><button data-simply-action="simply-text-class" data-value="red"><i class="fa fa-paint-brush"></i>Red</button></li>
				<li><button data-simply-action="simply-text-class" data-value="none"><i class="fa fa-times"></i>Default</button></li>
			</ul>
		</div -->
		<div class="simply-toolbar-section simply-text-align" data-type="simply-buttongroup-radio">
			<ul>
				<li><button data-simply-action="simply-text-align-left" data-value="left" class="simply-align-left"><i class="fa fa-align-left"></i>Left</button></li>
				<li><button data-simply-action="simply-text-align-center" data-value="center" class="simply-align-center"><i class="fa fa-align-center"></i>Center</button></li>
				<li><button data-simply-action="simply-text-align-right" data-value="right" class="simply-align-right"><i class="fa fa-align-right"></i>Right</button></li>
				<li><button data-simply-action="simply-text-align-justify" data-value="justify" class="simply-align-justify"><i class="fa fa-align-justify"></i>Justify</button></li>
				<li><button data-simply-action="simply-text-align-none" data-value="none" class="simply-align-none"><i class="fa fa-times"></i>None</button></li>
			</ul>
		</div>
		<div class="simply-toolbar-section simply-insert">
			<ul>
				<li><button data-simply-action="simply-insert-image" data-simply-section="simply-insert-image"><i class="fa fa-picture-o"></i>Image</button></li>
				<!-- li><button data-simply-action="simply-insert-table" data-simply-section="simply-insert-table"><i class="fa fa-table"></i>Table
					<div id="vdTablePopup" style="display: none;" unselectable="on">
						<div id="vdTablePreview" unselectable="on">
						</div>
						<div id="vdTableText" unselectable="on">
						</div>
					</div>
				</button></li -->
				<!-- li><button data-simply-action="simply-insert-symbol" data-simply-section="simply-insert-symbol"><i class="fa fa-eur"></i>Symbol</button></li -->
				<!-- li><button data-simply-action="simply-insert-gadget" data-simply-section="simply-insert-gadget"><i class="fa fa-puzzle-piece"></i>Gadget</button></li -->
				<li><button data-simply-action="simply-insert-source" data-simply-section="simply-insert-source"><i class="fa fa-code"></i>Code</button></li>
			</ul>
		</div>
		<div class="simply-toolbar-section simply-clipboard">
			<ul>
				<li><button class="simply-clipboard-paste"><i class="fa fa-clipboard"></i>Paste</button></li>
				<li><button class="simply-clipboard-select-all" data-simply-action="simply-clipboard-select-all"><i class="fa fa-arrows-alt"></i>Select all</button></li>
			</ul>
		</div>
	</div>
</section>
<section id="simply-text-selection" class="simply-section">
	<h1>*HTML Toolbar for Text Selection*</h1>
	<div class="simply-toolbar">
		<ul class="simply-buttons">
			<li><button data-simply-section="simply-text-style" class="simply-expands"><i class="fa fa-magic"></i>Style</button></li>
			<li><button data-simply-section="simply-text-align" class="simply-expands"><i class="fa fa-align-left"></i>Align</button></li>
			<li><button data-simply-section="simply-clipboard" class="simply-expands"><i class="fa fa-clipboard"></i>Clipboard</button></li>
			<li><button data-simply-section="simply-hyperlink" class="simply-expands"><i class="fa fa-link"></i>Link</button></li>
			<li><button data-simply-section="simply-code" data-simply-action="simply-edit-source"><i class="fa fa-code"></i>Code</button></li>
		</ul>
		<div class="simply-toolbar-section simply-text-style">
			<ul>
				<li class="simply-text-format"><select name="textStyle" data-simply-action="simply-text-blockstyle">
					<option value="h1">Heading 1</option>
					<option value="h2">Heading 2</option>
					<option value="h3">Heading 3</option>
					<option value="p">Paragraph</option>
				</select></li>
				<li class="simply-text-bold"><button data-simply-action="simply-text-bold"><i class="fa fa-bold"></i>Bold</button></li>
				<li class="simply-text-italic"><button data-simply-action="simply-text-italic"><i class="fa fa-italic"></i>Italic</button></li>
				<li class="simply-text-underline"><button data-simply-action="simply-text-underline"><i class="fa fa-underline"></i>Underline</button></li>
				<li class="simply-text-code"><button data-simply-action="simply-text-code"><i class="fa fa-code"></i>[Code]</button></li>
			</ul>
		</div>
		<div class="simply-toolbar-section simply-hyperlink">
			<div><label>URL</label><input type="text" id="vdHyperlinkHref" data-simply-action="simply-hyperlink-href"></div>
			<div><label>Title</label><input type="text" id="vdHyperlinkTitle" data-simply-action="simply-hyperlink-title"></div>
			<div><label>Name</label><input type="text" id="vdHyperlinkName" data-simply-action="simply-hyperlink-name"></div>
			<div><button class="simply-hyperlink-nofollow" data-simply-action="simply-hyperlink-nofollow"><i class="fa fa-chain-broken"></i>Nofollow</button></div>
		</div>
		<div class="simply-toolbar-section simply-text-align" data-type="simply-buttongroup-radio">
			<ul>
				<li><button data-simply-action="simply-text-align-left" data-value="left" class="simply-align-left"><i class="fa fa-align-left"></i>Left</button></li>
				<li><button data-simply-action="simply-text-align-center" data-value="center" class="simply-align-center"><i class="fa fa-align-center"></i>Center</button></li>
				<li><button data-simply-action="simply-text-align-right" data-value="right" class="simply-align-right"><i class="fa fa-align-right"></i>Right</button></li>
				<li><button data-simply-action="simply-text-align-justify" data-value="justify" class="simply-align-justify"><i class="fa fa-align-justify"></i>Justify</button></li>
				<li><button data-simply-action="simply-text-align-none" data-value="none" class="simply-align-none"><i class="fa fa-times"></i>None</button></li>
			</ul>
		</div>
		<div class="simply-toolbar-section simply-clipboard">
			<ul>
				<li><button class="simply-clipboard-cut"><i class="fa fa-scissors"></i>Cut</button></li>
				<li><button class="simply-clipboard-copy"><i class="fa fa-files-o"></i>Copy</button></li>
				<li><button class="simply-clipboard-paste"><i class="fa fa-clipboard"></i>Paste</button></li>
				<li><button class="simply-clipboard-select-all" data-simply-action="simply-clipboard-select-all"><i class="fa fa-arrows-alt"></i>Select all</button></li>
			</ul>
		</div>
	</div>
</section>
<script type="text/javascript">
	window.setTimeout(function() {
		editor.plugins.text = {};
	}, 3000);

	var updateTextToolbar = function(toolbar) {
		var sel = vdSelectionState.get();
		var parent = vdSelection.getNode(sel);
		var field = editor.node.getEditableField();

		hopeEditor = field.hopeEditor;

		hopeEditor.selection.updateRange();

		var range = hopeEditor.selection.getRange();

		var blockAnnotation = hopeEditor.getBlockAnnotation(range.start);

		if (blockAnnotation) {
			var tagName = blockAnnotation.tag.split(/ /, 2)[0].toLowerCase();
			var foundTag = toolbar.querySelector("[name='textStyle'] option[value='" + tagName + "']");
			if (foundTag) {
				foundTag.selected = true;
			} else {
				toolbar.querySelector("[name='textStyle'] option[value='p']").selected = true;
			}
		} else {
			toolbar.querySelector("[name='textStyle'] option[value='p']").selected = true;
		}


		// Check "Bold"
		var textBold = toolbar.querySelector(".simply-text-bold button");
		if (hopeEditor.fragment.has(range, "strong")) {
			textBold.classList.add("simply-selected");
		} else {
			textBold.classList.remove("simply-selected");
		}

		// Check "Italic"
		var textItalic = toolbar.querySelector(".simply-text-italic button");
		if (hopeEditor.fragment.has(range, "em")) {
			textItalic.classList.add("simply-selected");
		} else {
			textItalic.classList.remove("simply-selected");
		}

		// Check "Underline"
		var textUnderline = toolbar.querySelector(".simply-text-underline button");
		if (hopeEditor.fragment.has(range, "u")) {
			textUnderline.classList.add("simply-selected");
		} else {
			textUnderline.classList.remove("simply-selected");
		}

		// Check "Code"
		var textCode = toolbar.querySelector(".simply-text-code button");
		if (hopeEditor.fragment.has(range, "code")) {
			textCode.classList.add("simply-selected");
		} else {
			textCode.classList.remove("simply-selected");
		}

		// Check hyperlink;
		var hyperlink = hopeEditor.fragment.has(range, "a");
		if (hyperlink || (hopeEditor.field.tagName.toLowerCase() === 'a')) {
			var tempNode;
			if (hyperlink) {
				tempNode = editor.plugins.hope.annotation.explode(hyperlink.tag);
			} else {
				tempNode = hopeEditor.field;
			}
			var hyperlinkHref = tempNode.getAttribute('href');
			simply.widgets.properties.set(toolbar.querySelector("#vdHyperlinkHref"), hyperlinkHref);

			var hyperlinkTitle = tempNode.getAttribute('title');
			simply.widgets.properties.set(toolbar.querySelector('#vdHyperlinkTitle'), hyperlinkTitle);

			var hyperlinkName = tempNode.getAttribute('name');
			simply.widgets.properties.set(toolbar.querySelector('#vdHyperlinkName'), hyperlinkName);
			
			var hyperlinkNofollow = toolbar.querySelector("button.simply-hyperlink-nofollow");
			if (hyperlinkNofollow) {
				if (tempNode.getAttribute("rel") && tempNode.getAttribute("rel").match(/nofollow/)) {
					hyperlinkNofollow.classList.add("simply-selected");
				} else {
					hyperlinkNofollow.classList.remove("simply-selected");
				}
			}
		} else {
			simply.widgets.properties.set(toolbar.querySelector("#vdHyperlinkHref"), '');
			simply.widgets.properties.set(toolbar.querySelector('#vdHyperlinkTitle'), '');
			simply.widgets.properties.set(toolbar.querySelector('#vdHyperlinkName'), '');
			
			var hyperlinkNofollow = toolbar.querySelector("button.simply-hyperlink-nofollow");
			if (hyperlinkNofollow) {
				hyperlinkNofollow.classList.remove("simply-selected");
			}
		}

		// Check aligment
		blockAnnotation = hopeEditor.getBlockAnnotation(range.start);
		var textAlign = toolbar.querySelector(".simply-text-align[data-type=simply-buttongroup-radio]");
		if (blockAnnotation && textAlign) {
			var tempNode = editor.plugins.hope.annotation.explode(blockAnnotation.tag);
			if (tempNode.classList.contains("simply-text-align-left")) {
				simply.widgets.properties.set(textAlign, "left");
			} else if (tempNode.classList.contains("simply-text-align-right")) {
				simply.widgets.properties.set(textAlign, "right");
			} else if (tempNode.classList.contains("simply-text-align-center")) {
				simply.widgets.properties.set(textAlign, "center");
			} else if (tempNode.classList.contains("simply-text-align-justify")) {
				simply.widgets.properties.set(textAlign, "justify");
			} else {
				simply.widgets.properties.set(textAlign, "none");
			}

			if (simply.widgets.properties.get(textAlign) != "none") {
				// Set the parent icon for alignment as well;
				var currentIcon = toolbar.querySelector("div.simply-text-align button.simply-selected i");
				var icons = toolbar.querySelectorAll("button[data-simply-section=simply-text-align] i");
				for (i=0; i<icons.length; i++) {
					icons[i].className = currentIcon.className;
				}
			} else {
				var currentIcon = toolbar.querySelector("div.simply-text-align button i");
				var icons = toolbar.querySelectorAll("button[data-simply-section=simply-text-align] i");
				for (i=0; i<icons.length; i++) {
					icons[i].className = currentIcon.className;
				}
			}
		}

		var textClasses = toolbar.querySelectorAll(".simply-text-class [data-type=simply-buttongroup-radio]");
		if (blockAnnotation && textClasses) {
			var tempNode = editor.plugins.hope.annotation.explode(blockAnnotation.tag);
			for (var i=0; i<textClasses.length; i++) {
				var buttons = textClasses[i].querySelectorAll("[data-value]");
				simply.widgets.properties.set(textClasses[i], "none");
				for (var j=0; j<buttons.length; j++) {
					if (tempNode.classList.contains(buttons[j].getAttribute("data-value"))) {
						simply.widgets.properties.set(textClasses[i], buttons[j].getAttribute("data-value"));
					}
				}
			}
		}

		return true;
	}

	editor.plugins.hope = {
		annotation : {
			explode : function(tag) {
				var tempElm = document.createElement("DIV");
				tempElm.innerHTML = "<" + tag + ">";
				var tempNode = tempElm.childNodes[0];

				return tempNode;
			},
			implode : function(node) {
				if (node.className == '') {
					node.removeAttribute("class");
				}
				result = node.tagName.toLowerCase();
				for (i=0; i<node.attributes.length; i++) {
					result += " " + node.attributes[i].name + "=\"" + node.attributes[i].value + "\"";
				}
				return result;
			}
		}
	};

	editor.addToolbar({
		"name" : "simply-text-cursor",
		"filter" : {
			"sel-collapsed" : true
		},
		update : updateTextToolbar
	});

	editor.addToolbar({
		name : "simply-text-selection",
		filter : {
			"sel-collapsed" : false
		},
		update : updateTextToolbar,
		actions : {
			'simply-text-class' : function(el) {
				var range = hopeEditor.selection.getRange();
				var blockAnnotation = hopeEditor.getBlockAnnotation(range.start);

				var tempNode = editor.plugins.hope.annotation.explode(blockAnnotation.tag);
				if (tempNode.classList.contains(el.getAttribute("data-value"))) {
					tempNode.classList.remove(el.getAttribute("data-value"));
				} else {
					var buttons = el.parentNode.parentNode.querySelectorAll("[data-value]");
					for (var i=0; i<buttons.length; i++) {
						tempNode.classList.remove(buttons[i].getAttribute("data-value"));
					}
					if (el.getAttribute("data-value") !== "none") {
						tempNode.classList.add(el.getAttribute("data-value"));
					}
				}
				
				var newValue = editor.plugins.hope.annotation.implode(tempNode);

				hopeEditor.fragment = hopeEditor.fragment.remove(blockAnnotation.range, blockAnnotation.tag);
				hopeEditor.fragment = hopeEditor.fragment.apply(blockAnnotation.range, newValue);
				hopeEditor.update();
			},
			'simply-text-bold' : function() {
				var range = hopeEditor.selection.getRange();
				var annotation = hopeEditor.fragment.has(range, "strong");
				if (annotation) {
					hopeEditor.fragment = hopeEditor.fragment.remove(annotation.range, annotation.tag);
				} else {
					hopeEditor.fragment = hopeEditor.fragment.apply(range, "strong");
				}
				hopeEditor.update();
			},
			'simply-text-italic' : function(el) {
				var range = hopeEditor.selection.getRange();
				var annotation = hopeEditor.fragment.has(range, "em");
				if (annotation) {
					hopeEditor.fragment = hopeEditor.fragment.remove(annotation.range, annotation.tag);
				} else {
					hopeEditor.fragment = hopeEditor.fragment.apply(range, "em");
				}
				hopeEditor.update();
			},
			'simply-text-underline' : function() {
				var range = hopeEditor.selection.getRange();
				var annotation = hopeEditor.fragment.has(range, "u");
				if (annotation) {
					hopeEditor.fragment = hopeEditor.fragment.remove(annotation.range, annotation.tag);
				} else {
					hopeEditor.fragment = hopeEditor.fragment.apply(range, "u");
				}
				hopeEditor.update();
			},
			'simply-text-code' : function() {
				var range = hopeEditor.selection.getRange();
				var annotation = hopeEditor.fragment.has(range, "code");
				if (annotation) {
					hopeEditor.fragment = hopeEditor.fragment.remove(annotation.range, annotation.tag);
				} else {
					hopeEditor.fragment = hopeEditor.fragment.apply(range, "code");
				}
				hopeEditor.update();
			},
			'simply-text-align-left' : function() {
				var range = hopeEditor.selection.getRange();
				var blockAnnotation = hopeEditor.getBlockAnnotation(range.start);

				var tempNode = editor.plugins.hope.annotation.explode(blockAnnotation.tag);
				if (tempNode.classList.contains("simply-text-align-left")) {
					tempNode.classList.remove("simply-text-align-left");
				} else {
					tempNode.classList.remove("simply-text-align-center");
					tempNode.classList.remove("simply-text-align-justify");
					tempNode.classList.remove("simply-text-align-right");

					tempNode.classList.add("simply-text-align-left");
				}
				
				var newValue = editor.plugins.hope.annotation.implode(tempNode);

				hopeEditor.fragment = hopeEditor.fragment.remove(blockAnnotation.range, blockAnnotation.tag);
				hopeEditor.fragment = hopeEditor.fragment.apply(blockAnnotation.range, newValue);
				hopeEditor.update();
			},
			'simply-text-align-right' : function() {
				var range = hopeEditor.selection.getRange();
				var blockAnnotation = hopeEditor.getBlockAnnotation(range.start);

				var tempNode = editor.plugins.hope.annotation.explode(blockAnnotation.tag);
				if (tempNode.classList.contains("simply-text-align-right")) {
					tempNode.classList.remove("simply-text-align-right");
				} else {
					tempNode.classList.remove("simply-text-align-left");
					tempNode.classList.remove("simply-text-align-justify");
					tempNode.classList.remove("simply-text-align-center");

					tempNode.classList.add("simply-text-align-right");
				}
				
				var newValue = editor.plugins.hope.annotation.implode(tempNode);

				hopeEditor.fragment = hopeEditor.fragment.remove(blockAnnotation.range, blockAnnotation.tag);
				hopeEditor.fragment = hopeEditor.fragment.apply(blockAnnotation.range, newValue);

				hopeEditor.update();
			},
			'simply-text-align-center' : function() {
				var range = hopeEditor.selection.getRange();
				var blockAnnotation = hopeEditor.getBlockAnnotation(range.start);

				var tempNode = editor.plugins.hope.annotation.explode(blockAnnotation.tag);
				if (tempNode.classList.contains("simply-text-align-center")) {
					tempNode.classList.remove("simply-text-align-center");
				} else {
					tempNode.classList.remove("simply-text-align-left");
					tempNode.classList.remove("simply-text-align-justify");
					tempNode.classList.remove("simply-text-align-right");

					tempNode.classList.add("simply-text-align-center");
				}
				
				var newValue = editor.plugins.hope.annotation.implode(tempNode);

				hopeEditor.fragment = hopeEditor.fragment.remove(blockAnnotation.range, blockAnnotation.tag);
				hopeEditor.fragment = hopeEditor.fragment.apply(blockAnnotation.range, newValue);
				hopeEditor.update();
			},
			'simply-text-align-justify' : function() {
				var range = hopeEditor.selection.getRange();
				var blockAnnotation = hopeEditor.getBlockAnnotation(range.start);

				var tempNode = editor.plugins.hope.annotation.explode(blockAnnotation.tag);
				if (tempNode.classList.contains("simply-text-align-justify")) {
					tempNode.classList.remove("simply-text-align-justify");
				} else {
					tempNode.classList.remove("simply-text-align-left");
					tempNode.classList.remove("simply-text-align-right");
					tempNode.classList.remove("simply-text-align-center");

					tempNode.classList.add("simply-text-align-justify");
				}
				
				var newValue = editor.plugins.hope.annotation.implode(tempNode);

				hopeEditor.fragment = hopeEditor.fragment.remove(blockAnnotation.range, blockAnnotation.tag);
				hopeEditor.fragment = hopeEditor.fragment.apply(blockAnnotation.range, newValue);
				hopeEditor.update();
			},
			'simply-text-align-none' : function() {
				var range = hopeEditor.selection.getRange();
				var blockAnnotation = hopeEditor.getBlockAnnotation(range.start);

				var tempNode = editor.plugins.hope.annotation.explode(blockAnnotation.tag);
				tempNode.classList.remove("simply-text-align-justify");
				tempNode.classList.remove("simply-text-align-left");
				tempNode.classList.remove("simply-text-align-right");
				tempNode.classList.remove("simply-text-align-center");

				var newValue = editor.plugins.hope.annotation.implode(tempNode);

				hopeEditor.fragment = hopeEditor.fragment.remove(blockAnnotation.range, blockAnnotation.tag);
				hopeEditor.fragment = hopeEditor.fragment.apply(blockAnnotation.range, newValue);
				hopeEditor.update();
			},
			'simply-text-blockstyle' : function(value) {
				var range = hopeEditor.selection.getRange();

				if (range.start != range.end) {
					if (hopeEditor.fragment.has(range, value)) {
						hopeEditor.fragment = hopeEditor.fragment.remove(range, value);
					} else {
						hopeEditor.fragment = hopeEditor.fragment.apply(range, value);
					}
				} else {
					var blockAnnotation = hopeEditor.getBlockAnnotation(range.start);
					if (blockAnnotation) {
						var nodeInfo = false;
						if (blockAnnotation.tag.indexOf(" ") !== -1) {
							nodeInfo = blockAnnotation.tag.substr(blockAnnotation.tag.indexOf(" ")+1);
						}
						var newValue = value;
						if (nodeInfo) {
							newValue += " " + nodeInfo;
						}
						hopeEditor.fragment = hopeEditor.fragment.remove(blockAnnotation.range, blockAnnotation.tag);
						hopeEditor.fragment = hopeEditor.fragment.apply(blockAnnotation.range, newValue);
					} else {
						var sel = window.getSelection();
						range = window.getSelection().getRangeAt(0);
						range.setStart(sel.focusNode,0);
						range.setEnd(sel.focusNode, sel.focusNode.length);
						window.getSelection().removeAllRanges();
						sel.addRange(range);
						hopeEditor.selection.updateRange();
						range = hopeEditor.selection.getRange();
						hopeEditor.fragment = hopeEditor.fragment.apply(hopeEditor.selection.getRange(), value);
					}
				}

				hopeEditor.update();
			},
			"simply-hyperlink-href" : function(value) {
				if (hopeEditor.field.tagName.toLowerCase() === 'a') {
					hopeEditor.field.setAttribute("href", value);
					return;
				}

				var range = hopeEditor.selection.getRange();
				var hyperlink = hopeEditor.fragment.has(range, "a");
				
				if (!hyperlink) {
					hopeEditor.fragment = hopeEditor.fragment.apply(range, 'a href="' + value + '"');
				} else {
					var tempNode = editor.plugins.hope.annotation.explode(hyperlink.tag);
					tempNode.setAttribute("href", value);
					var newValue = editor.plugins.hope.annotation.implode(tempNode);
					hopeEditor.fragment = hopeEditor.fragment.remove(hyperlink.range, hyperlink.tag);
					hopeEditor.fragment = hopeEditor.fragment.apply(hyperlink.range, newValue);
				}
				hopeEditor.update();
			},
			"simply-hyperlink-title" : function(value) {
				if (hopeEditor.field.tagName.toLowerCase() === 'a') {
					hopeEditor.field.setAttribute("title", value);
					return;
				}

				var range = hopeEditor.selection.getRange();
				var hyperlink = hopeEditor.fragment.has(range, "a");
				
				if (!hyperlink) {
					hopeEditor.fragment = hopeEditor.fragment.apply(range, 'a title="' + value + '"');
				} else {
					var tempNode = editor.plugins.hope.annotation.explode(hyperlink.tag);
					tempNode.setAttribute("title", value);
					var newValue = editor.plugins.hope.annotation.implode(tempNode);
					hopeEditor.fragment = hopeEditor.fragment.remove(hyperlink.range, hyperlink.tag);
					hopeEditor.fragment = hopeEditor.fragment.apply(hyperlink.range, newValue);
				}
				hopeEditor.update();
			},
			"simply-hyperlink-name" : function(value) {
				if (hopeEditor.field.tagName.toLowerCase() === 'a') {
					hopeEditor.field.setAttribute("name", value);
					return;
				}

				var range = hopeEditor.selection.getRange();
				var hyperlink = hopeEditor.fragment.has(range, "a");
				
				if (!hyperlink) {
					hopeEditor.fragment = hopeEditor.fragment.apply(range, 'a name="' + value + '"');
				} else {
					var tempNode = editor.plugins.hope.annotation.explode(hyperlink.tag);
					tempNode.setAttribute("name", value);
					var newValue = editor.plugins.hope.annotation.implode(tempNode);
					hopeEditor.fragment = hopeEditor.fragment.remove(hyperlink.range, hyperlink.tag);
					hopeEditor.fragment = hopeEditor.fragment.apply(hyperlink.range, newValue);
				}
				hopeEditor.update();
			},
			"simply-hyperlink-nofollow" : function(button) {
				if (hopeEditor.field.tagName.toLowerCase() === 'a') {
					if (hopeEditor.field.getAttribute("rel") == "nofollow") {
						hopeEditor.field.removeAttribute("rel");
						button.classList.remove("simply-selected");
					} else {
						hopeEditor.field.setAttribute("rel", "nofollow");
						button.classList.add("simply-selected");
					}
					return;
				}

				var range = hopeEditor.selection.getRange();
				var hyperlink = hopeEditor.fragment.has(range, "a");
				
				if (!hyperlink) {
					hopeEditor.fragment = hopeEditor.fragment.apply(range, 'a rel="nofollow"');
				} else {
					var tempNode = editor.plugins.hope.annotation.explode(hyperlink.tag);

					if (tempNode.getAttribute("rel") == "nofollow") {
						tempNode.removeAttribute("rel");
						button.classList.remove("simply-selected");
					} else {
						tempNode.setAttribute("rel", "nofollow");
						button.classList.add("simply-selected");
					}
					var newValue = editor.plugins.hope.annotation.implode(tempNode);
					hopeEditor.fragment = hopeEditor.fragment.remove(hyperlink.range, hyperlink.tag);
					hopeEditor.fragment = hopeEditor.fragment.apply(hyperlink.range, newValue);
				}
				hopeEditor.update();
			}
		}
	});
	editor.addContextFilter("simply-hyperlink", {
		"selector" : "A",
		"parent" : {
			"selector" : "*"
		},
		"context" : "simply-text-selection"
	});
	editor.addContextFilter("simply-textonly", {
		"selector" : "[data-simply-content='text']",
		"context" : "simply-no-context"
	});
</script>