<section id="vedor-image" class="vedor-section">
	<h1>HTML Image Toolbar</h1>
	<div class="vedor-toolbar">
		<ul class="vedor-buttons">
			<li><button data-vedor-section="vedor-image-style" class="vedor-expands"><i class="fa fa-magic"></i>Style</button></li>
			<li><button data-vedor-section="vedor-image-align" class="vedor-expands"><i class="fa fa-align-left"></i>Align</button></li>
			<li><button data-vedor-section="vedor-clipboard" class="vedor-expands"><i class="fa fa-clipboard"></i>Clipboard</button></li>
			<li><button data-vedor-section="vedor-image-edit" class="vedor-expands"><i class="fa fa-pencil"></i>Edit</button></li>
			<li><button data-vedor-section="vedor-image-properties" class="vedor-expands"><i class="fa fa-tags"></i>Properties</button></li>
		</ul>
		<div class="vedor-toolbar-section vedor-image-style">
			<ul>
				<li><label>Format</label><select id="vdImageType">
					<option value="">Original</option>
				</select></li>
			</ul>
		</div>
		<div class="vedor-toolbar-section vedor-image-align" data-type="vedor-buttongroup-radio" id="vdImageAlign">
		<ul>
			<li><button class="vedor-align-left" data-value="left" data-vedor-action="vedor-image-align-left"><i class="fa fa-align-left"></i>Left</button></li>
			<li><button class="vedor-align-center" data-value="center" data-vedor-action="vedor-image-align-center"><i class="fa fa-align-center"></i>Center</button></li>
			<li><button class="vedor-align-right" data-value="right" data-vedor-action="vedor-image-align-right"><i class="fa fa-align-right"></i>Right</button></li>
			<li><button class="vedor-align-none" data-value="none" data-vedor-action="vedor-image-align-none"><i class="fa fa-minus-circle"></i>None</button></li>
		</ul>
		</div>
		<div class="vedor-toolbar-section vedor-image-properties">
			<div><label>Alt</label><input type="text" id="vdImageAlt"></div>
			<div><label>Title</label><input type="text" id="vdImageTitle"></div>
		</div>
		<div class="vedor-toolbar-section vedor-image-edit">
			<ul>
				<li><button class="vedor-image-upload" data-vedor-action="vedor-image-upload"><i class="fa fa-cloud-upload"></i>Upload</button></li>
				<li><button class="vedor-image-browse" data-vedor-action="vedor-image-browse"><i class="fa fa-folder-open"></i>Browse</button></li>
				<!-- li><button class="vedor-image-editor" data-vedor-action="vedor-image-editor"><i class="fa fa-pencil-square-o"></i>Edit image</button></li -->
				<li><button class="vedor-image-delete" data-vedor-action="vedor-image-delete"><i class="fa fa-trash-o"></i>Delete</button></li>
				<li><button class="vedor-image-link" data-vedor-action="vedor-hyperlink-insert"><i class="fa fa-link"></i>Link</button></li>
				<li><button data-vedor-section="vedor-code" data-vedor-action="vedor-edit-source"><i class="fa fa-code"></i>Code</button></li>
			</ul>
		</div>
		<div class="vedor-toolbar-section vedor-clipboard">
			<ul>
				<li><button class="vedor-clipboard-cut"><i class="fa fa-scissors"></i>Cut</button></li>
				<li><button class="vedor-clipboard-copy"><i class="fa fa-files-o"></i>Copy</button></li>
				<li><button class="vedor-clipboard-paste"><i class="fa fa-clipboard"></i>Paste</button></li>
			</ul>
		</div>
	</div>
</section>
<script type="text/javascript">
	editor.addToolbar({
		"name" : "vedor-image",
		"filter" : {
			"selector" : "IMG",
			"parent" : {
				"selector" : "*"
			}
		},
		"update" : function() {
			var sel = vdSelectionState.get();
			var image = vdSelection.getNode(sel);

			currentImage = image;

			var type=image.getAttribute('data-vedor-image-type');
			if (!type || type=='undefined') {
				// type='Origineel'; // FIXME: gewoon de eerste in de lijst selecteren?
				type = document.querySelectorAll("#vdImageType option")[0].value;
			}
			vdSetProperty('vdImageType',type);

			var alt=image.getAttribute('alt');
			vdSetProperty('vdImageAlt',alt);

			var align = image.getAttribute("align");
			vdSetProperty('vdImageAlign', align);

			var title=image.getAttribute('title');
			vdSetProperty('vdImageTitle', title);

			// Set the parent icon for alignment as well;
			var currentIcon = document.querySelectorAll("div.vedor-image-align button.vedor-selected i")[0];
			if (currentIcon) {
				var icons = document.querySelectorAll("button[data-vedor-section=vedor-image-align] i");
				for (var i=0; i<icons.length; i++) {
					icons[i].className = currentIcon.className;
				}
			}
		},
		"init" : function() {
			console.log("init image toolbar");

			vdSetImage = function() {
				if (currentImage) {
					var type=vdGetProperty('vdImageType');
					currentImage.setAttribute('data-vedor-image-type',type);

					var align=vdGetProperty('vdImageAlign');
					if (align=='none') {
						currentImage.removeAttribute('align');
					} else {
						currentImage.setAttribute('align',align);
					}
					var alt=vdGetProperty('vdImageAlt');
					if (alt) {
						currentImage.setAttribute('alt',alt);
					} else {
						currentImage.removeAttribute('alt');
					}
					var title=vdGetProperty('vdImageTitle');
					if (title) {
						currentImage.setAttribute('title',title);
					} else {
						currentImage.removeAttribute('title');
					}
					vdStoreUndo();
				}
			};


			document.querySelector("#vdImageAlt").addEventListener("change", vdSetImage);
			document.querySelector("#vdImageTitle").addEventListener("change", vdSetImage);
			document.querySelector("#vdImageType").addEventListener("change", vdSetImage);
		}
	});
</script>