<!DOCTYPE HTML>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title data-simply-field="meta title">Simply edit - RSS datasource example</title>
	<meta name="description" content="Simple edit testpage description" data-simply-field="meta description">
	<meta name="robots" content="noindex,nofollow" data-simply-field="meta robots">
	<meta name="author" content="" data-simply-field="meta author">
	<meta name="page-template" content="index.html" data-simply-field="data-simply-page-template">
	<meta charset="utf-8"> 
	<style type="text/css">
		html,body {
			padding: 0;
			margin: 0;
			font-family: arial;
		}

		@media (min-width: 960px) {
			body > div {
				width: 960px;
				margin: 0px auto;
			}
		}

		a img {
			border: 0;
		}

		a {
			color: black;
		}
		.article {
			border: 1px solid #ccc;
			border-radius: 5px;
			padding: 5px;
			margin: 1%;
			font-size: 13px;
			width: 48%;
			box-sizing: border-box;
			display: inline-block;
			vertical-align: top;
		}
		.article h1 {
			font-family: tahoma;
			margin: 0px;
			font-size: 17px;
			margin-bottom: 10px;
		}

		.article .image {
			float: left;
			margin-right: 20px;
		}
		.article .prijs {
			font-weight: bold;
		}

		.description:after {
			content: "";
			display: block;
			clear: both;
		}
		.simply-empty:after { 
                        text-align: center;
                        content: "Loading...";
                        display: block;
                        position: absolute;
                        top: 50px;
                        left: 50%;
                        margin-left: -120px;
                        width: 200px;
                        padding: 20px;
                        background-color: #f8f8f8;
                        font-family: helvetica;
                        border: 1px solid #888;
                        border-radius: 20px;
                        box-shadow: 2px 2px 5px 0px #333;
                }
		.article .link {
			text-align: right;
		}
		@media (max-width: 768px) {
			.article {
				width: 98%;
			}
		}
		@media (max-width: 480px) {
			.article .image {
				width: 100%;
				text-align: center;
				margin-bottom: 20px;
			}
		}
	</style>
</head>
<body>
	<div data-simply-list="news" data-simply-data="newsList">
		<template data-simply-template="large"><div class="large article">
			<h1 data-simply-field="title">title</h1>
			<div class="image" data-simply-field="image"></div>
			<div class="description">
				<span class="prijs" data-simply-field="prijs">prijs</span><br>
				<!-- span data-simply-field="datum">datum</span><br><br -->
				<br><span data-simply-field="description">prijs</span><br>
			</div>
			<div class="link">&raquo; <a href="#" data-simply-field="url">Bekijk op marktplaats</a></div>
		</div></template>
	</div>
	<script src="/simply-edit/js/simply-edit.js" 
		data-api-key="muze" 
		data-simply-endpoint="http://yvo.muze.nl/ariadne/loader.php/system/users/yvo/simply-store/"
		data-simply-images="http://yvo.muze.nl/ariadne/loader.php/system/users/yvo/simply-store/img/"
	></script>
	<script>
		var http = new XMLHttpRequest();
		var url = "http://crossorigin.me/http://www.rss-widget.nl/opensearch.php?s=30&ui=14863699";

		http.open("GET", url, true);
		http.onreadystatechange = function() {//Call a function when the state changes.
			if(http.readyState == 4) {
				if (http.status == 200) {
					var parser = new DOMParser();
					var xmlDoc = parser.parseFromString(http.responseText.replace(/\]\]\>/g, " ]]>"), "text/xml");

					var items = xmlDoc.querySelectorAll("item");
					var result = [];
					for (var i=0; i<items.length; i++) {
						console.log(items[i].querySelector("description").childNodes[0].nodeValue);
						console.log(decodeURIComponent(items[i].querySelector("description")));
						var desc = items[i].querySelector("description").childNodes[0].nodeValue;
						var descInfo = desc.split(" - ");

						result.push({
							title : items[i].querySelector("title").innerHTML.replace("&amp;", "&").replace(/^Aangeboden: /, ''),
							image : descInfo[0],
							prijs : descInfo[1],
							datum : descInfo[2],
							description : descInfo[3],
							url : {
								href : items[i].querySelector("link").innerHTML.replace("&amp;", "&")
							},
							"data-simply-template" : ((i < 2) ? "large" : "small" )
						});
					}
					editor.addDataSource("newsList", {
						load : result
					});
				}
			}
		};
		http.send();
	</script>
</body>
</html>