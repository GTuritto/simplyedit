<section id="vedor-symbol" class="vedor-dialog">
	<div class="vedor-toolbar">
		<ul class="vedor-buttons">
			<li class='vedor-right'><button data-vedor-action="vedor-dialog-close"><i class="fa fa-times"></i>Cancel</button></li>
			<li class='vedor-right'><button data-vedor-action="vedor-dialog-fullscreen"><i class="fa fa-expand"></i>Full screen</button></li>
		</ul>
	</div>
	<div class="vedor-dialog-body">
	</div>
</section>
<style type="text/css">
	#vedor-symbol {
		top: 50%;
		height: 400px;
		max-height: 80%;
		margin-top: -200px;
		left: 50%;
		margin-left: -235px;
		background-color: #EEE;
		padding-top: 61px;
		box-sizing: border-box;
	}
	#vedor-symbol.fullscreen {
		top: 0px;
		bottom: 0px;
		left: 0px;
		right: 0px;
		max-width: 100%;
		max-height: 100%;
		height: auto;
		width: auto;
		margin-left: 0px;
		margin-top: 0px;
	}
	#vedor-symbol .vedor-dialog-body {
		overflow-y: scroll;
		padding: 0px;
		width: 470px;
		padding-left: 2px;
	}
	#vedor-symbol.fullscreen .vedor-dialog-body {
		width: 100%;
	}
	#vedor-symbol .vedor-dialog-body button {
		border: 1px solid #eee;
		background-color: white;
		height: 50px;
		width: 50px;
		font-family: inherit;
		font-size: 20px;
	}
	@media (max-width: 481px) {
		#vedor-symbol {
			top: 0px;
			bottom: 0px;
			left: 0px;
			right: 0px;
			max-width: 100%;
			max-height: 100%;
			height: auto;
			width: auto;
			margin-left: 0px;
			margin-top: 0px;
		}
		#vedor-symbol [data-vedor-action="vedor-symbol-fullscreen"] {
			display: none;
		}
	}
</style>
<script>
	editor.plugins.symbol = {
		currentSel : null,
		currentField : null,
		dialog : {
			open : function() {
				editor.plugins.symbol.currentSel = vdSelectionState.get();
				editor.plugins.symbol.currentField = editor.node.getEditableField();
				editor.plugins.dialog.open(document.getElementById('vedor-symbol'), editor.plugins.symbol.dialog.update);
			},
			update : function() {
				var parent = vdSelection.getNode(editor.plugins.symbol.currentSel);
				var styles = editor.node.getAllStyles(parent);

				var targetList = document.querySelector("#vedor-symbol .vedor-dialog-body");
				targetList.style.fontFamily = styles['font-family'];

				newHtml = '';
				for (var i=33; i<400; i++) {
					if (i == 173) {
						continue; // &shy
					}
					newHtml += "<button data-vedor-action='vedor-symbol-insert' data-value=" + i + ">&#" + i + ";</button>";
				}
				targetList.innerHTML = newHtml;
				window.setTimeout(function() {
					for (var i=400; i<2000; i++) {
						newHtml += "<button data-vedor-action='vedor-symbol-insert' data-value=" + i + ">&#" + i + ";</button>";
					}
					targetList.innerHTML = newHtml;
				}, 1);
			}
		}
	};

	editor.addAction("vedor-symbol", editor.plugins.symbol.dialog.open);
	editor.addAction("vedor-symbol-insert", function(el) {
		if (!editor.plugins.symbol.currentSel.collapsed) {
			editor.plugins.text.formatInline('delete'); // this is somehow needed to trick IE into breaking potential <P>'s into 2
		}
		vdSelection.setHTMLText(editor.plugins.symbol.currentSel, "&#" + el.dataset.value + ";");
		editor.plugins.dialog.close();
	});

	var inserts = document.querySelectorAll(".vedor-toolbar-section.vedor-insert > ul");
	for (var i=0; i<inserts.length; i++) {
		var symbolLi = document.createElement("LI");
		var symbolButton = document.createElement("BUTTON");
		symbolButton.dataset.vedorAction = "vedor-symbol";
		symbolButton.innerHTML = '<i class="fa fa-copyright"></i>Symbol';
		symbolLi.appendChild(symbolButton);
		inserts[i].appendChild(symbolLi);
	}
</script>