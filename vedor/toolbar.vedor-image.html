<section id="vedor-image" class="vedor-section">
	<h1>HTML Image Toolbar</h1>
	<div class="vedor-toolbar">
		<ul class="vedor-buttons">
			<li><button data-vedor-section="vedor-image-style" class="vedor-expands"><i class="fa fa-magic"></i>Style</button></li>
			<li><button data-vedor-section="vedor-image-align" class="vedor-expands"><i class="fa fa-align-left"></i>Align</button></li>
			<li><button data-vedor-section="vedor-clipboard" class="vedor-expands"><i class="fa fa-clipboard"></i>Clipboard</button></li>
			<li><button data-vedor-section="vedor-image-properties" class="vedor-expands"><i class="fa fa-tags"></i>Properties</button></li>
			<li><button data-vedor-section="vedor-hyperlink" class="vedor-expands"><i class="fa fa-link"></i>Link</button></li>
			<li><button data-vedor-section="vedor-code" data-vedor-action="vedor-edit-source"><i class="fa fa-code"></i>Code</button></li>
		</ul>
		<div class="vedor-toolbar-section vedor-image-style">
			<ul>
				<li><label>Format</label><select id="vdImageType" data-vedor-action=vedor-image-type">
					<option value="">Original</option>
				</select></li>
			</ul>
		</div>
		<div class="vedor-toolbar-section vedor-image-align" data-type="vedor-buttongroup-radio" id="vdImageAlign">
		<ul>
			<li><button class="vedor-align-left" data-value="left" data-vedor-action="vedor-image-align-left"><i class="fa fa-align-left"></i>Left</button></li>
			<li><button class="vedor-align-center" data-value="center" data-vedor-action="vedor-image-align-center"><i class="fa fa-align-center"></i>Center</button></li>
			<li><button class="vedor-align-right" data-value="right" data-vedor-action="vedor-image-align-right"><i class="fa fa-align-right"></i>Right</button></li>
			<li><button class="vedor-align-none" data-value="none" data-vedor-action="vedor-image-align-none"><i class="fa fa-minus-circle"></i>None</button></li>
		</ul>
		</div>
		<div class="vedor-toolbar-section vedor-image-properties">
			<div><label>URL</label><input type="text" id="vdImageSrc" data-vedor-action="vedor-image-src"></div>
			<div><label>Alt</label><input type="text" id="vdImageAlt" data-vedor-action="vedor-image-alt"></div>
			<div><label>Title</label><input type="text" id="vdImageTitle" data-vedor-action="vedor-image-title"></div>
		</div>
		<div class="vedor-toolbar-section vedor-hyperlink">
			<div><label>URL</label><input type="text" id="vdHyperlinkHref" data-vedor-action="vedor-hyperlink-href"></div>
			<div><label>Title</label><input type="text" id="vdHyperlinkTitle" data-vedor-action="vedor-hyperlink-title"></div>
			<div><label>Name</label><input type="text" id="vdHyperlinkName" data-vedor-action="vedor-hyperlink-name"></div>
			<div><button class="vedor-hyperlink-nofollow" data-vedor-action="vedor-hyperlink-nofollow"><i class="fa fa-chain-broken"></i>Nofollow</button></div>
		</div>
		<div class="vedor-toolbar-section vedor-clipboard">
			<ul>
				<li><button class="vedor-clipboard-cut"><i class="fa fa-scissors"></i>Cut</button></li>
				<li><button class="vedor-clipboard-copy"><i class="fa fa-files-o"></i>Copy</button></li>
				<li><button class="vedor-clipboard-paste"><i class="fa fa-clipboard"></i>Paste</button></li>
			</ul>
		</div>
	</div>
</section>
<script type="text/javascript">
	var currentImage;
	var currentLink;

	editor.addToolbar({
		"name" : "vedor-image",
		"filter" : {
			"selector" : "IMG",
			"parent" : {
				"selector" : "*"
			}
		},
		"update" : function(toolbar) {
			var sel = vdSelectionState.get();
			var image = vdSelection.getNode(sel);

			vdSelectionState.save();

			currentImage = image;

			var type=image.getAttribute('data-vedor-image-type');
			if (!type || type=='undefined') {
				// type='Origineel'; // FIXME: gewoon de eerste in de lijst selecteren?
				type = document.querySelectorAll("#vdImageType option")[0].value;
			}
			vdSetProperty('vdImageType',type);

			var alt=image.getAttribute('alt');
			vdSetProperty('vdImageAlt',alt);

			var align = image.getAttribute("align");
			vdSetProperty('vdImageAlign', align);

			var title=image.getAttribute('title');
			vdSetProperty('vdImageTitle', title);

			var src=image.getAttribute('src');
			vdSetProperty('vdImageSrc', src);

			currentLink = editor.plugins.hyperlink.get();

			if (currentLink.length) {
				var hyperlinkHref = currentLink[0].getAttribute('href');
				vdSetProperty('vdHyperlinkHref', hyperlinkHref);

				var hyperlinkTitle = currentLink[0].getAttribute('title');
				vdSetProperty('vdHyperlinkTitle', hyperlinkTitle);

				var hyperlinkName = currentLink[0].getAttribute('name');
				vdSetProperty('vdHyperlinkName', hyperlinkName);
				
				var hyperlinkNofollow = toolbar.querySelectorAll("button.vedor-hyperlink-nofollow");
				for (var i=0; i<hyperlinkNofollow.length; i++) {
					if (parent.getAttribute("rel") && parent.getAttribute("rel").match(/nofollow/)) {
						hyperlinkNofollow[i].classList.add("vedor-selected");
					} else {
						hyperlinkNofollow[i].classList.remove("vedor-selected");
					}
				}
			} else {
				vdSetProperty('vdHyperlinkHref', '');
				vdSetProperty('vdHyperlinkTitle', '');
				vdSetProperty('vdHyperlinkName', '');
				var hyperlinkNofollow = toolbar.querySelector("button.vedor-hyperlink-nofollow");
				if (hyperlinkNofollow) {
					hyperlinkNofollow.classList.remove("vedor-selected");
				}
			}

			// Set the parent icon for alignment as well;
			var currentIcon = document.querySelectorAll("div.vedor-image-align button.vedor-selected i")[0];
			if (currentIcon) {
				var icons = document.querySelectorAll("button[data-vedor-section=vedor-image-align] i");
				for (var i=0; i<icons.length; i++) {
					icons[i].className = currentIcon.className;
				}
			}
		},
		"init" : function() {
			vdSetImage = function() {
				if (currentImage) {
					var type=vdGetProperty('vdImageType');
					if (type) {
						currentImage.setAttribute('data-vedor-image-type',type);
					} else {
						currentImage.removeAttribute('data-vedor-image-type');
					}

					var align=vdGetProperty('vdImageAlign');

					if (align=='none' || align=='') {
						currentImage.removeAttribute('align');
					} else {
						currentImage.setAttribute('align',align);
					}
					vdStoreUndo();
				}
			};
		},
		"actions" : {
			"vedor-image-align-left" : function() {
				vdSetProperty("vdImageAlign", "left");
				vdSetImage();
			},
			"vedor-image-align-center" : function() {
				vdSetProperty("vdImageAlign", "center");
				vdSetImage();
			},
			"vedor-image-align-right" : function() {
				vdSetProperty("vdImageAlign", "right");
				vdSetImage();
			},
			"vedor-image-align-none" : function() {
				vdSetProperty("vdImageAlign", "none");
				vdSetImage();
			},
			"vedor-image-type" : function() {
				vdSetImage();
			},
			"vedor-image-delete" : function() {
				var sel = vdSelectionState.get();
				var image = vdSelection.getNode(sel);
				image.parentNode.removeChild(image);
			},
			"vedor-image-alt" : function(value) {
				if (currentImage) {
					if (value) {
						currentImage.setAttribute("alt", value);
					} else {
						currentImage.removeAttribute("alt");
					}
				}
			},
			"vedor-image-title" : function(value) {
				if (currentImage) {
					if (value) {
						currentImage.setAttribute("title", value);
					} else {
						currentImage.removeAttribute("title");
					}
				}
			},
			"vedor-image-src" : function(value) {
				if (currentImage) {
					if (value) {
						currentImage.setAttribute("src", value);
					} else {
						currentImage.removeAttribute("src");
					}
				}
			}
		}
	});
</script>