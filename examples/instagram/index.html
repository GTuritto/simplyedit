<!DOCTYPE HTML>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title data-simply-field="meta title">Simple edit</title>
	<meta name="description" content="Simple edit testpage description" data-simply-field="meta description">
	<meta name="robots" content="noindex,nofollow" data-simply-field="meta robots">
	<meta name="author" content="" data-simply-field="meta author">
	<meta name="page-template" content="index.html" data-simply-field="data-simply-page-template">
	<meta charset="utf-8"> 
</head>
<body>
	<h1 data-simply-field="title" data-simply-content="text">Thing goes here</h1>
	<div data-simply-field="page content">Other things go here</div>
	<img src="/simply-edit/imgs/muze.png" data-simply-field="image">
	<nav>
		Menu goes here!
		<ul data-simply-list="menu" data-simply-path="/simply-edit/" data-simply-sortable>
			<template>
				<li>
					<a href="/simply-edit/" data-simply-field="item">Menu item</a>
				</li>
			</template>
		</ul>
	</nav>
	<img src="/simply-edit/imgs/muze.png">
	<script>
		var imageSettings = {
			'responsive' : {
				'sizes' : function(src) {
					var image = src.split("image/upload");

					return {
						"640w" : image[0] + "image/upload/w_640" + image[1],
						"480w" : image[0] + "image/upload/w_480" + image[1],
						"320w" : image[0] + "image/upload/w_320" + image[1],
						"160w" : image[0] + "image/upload/w_160" + image[1],
						"80w" : image[0] + "image/upload/w_80" + image[1],
					}
				}
			}
		};
		var myCustomSettings = {
			'simply-image' : imageSettings
		};
	</script>
</html>	<script src="/simply-edit/js/simply-edit.js" 
		data-api-key="muze"
		data-simply-images="https://www.instagram.com/cashcats/"
		data-simply-endpoint="http://yvo.muze.nl/ariadne/loader.php/system/users/yvo/simply-store/"
		data-simply-settings="myCustomSettings"
	></script>
	<script>
		(function() {
			var normalList = editor.storage.list;
			editor.storage.list = function(url, callback) {
				if (url.indexOf(editor.storage.imagesEndpoint) !== 0) {
					return normalList(url, callback);
				}

				var result = {
					images : [],
					folders : [],
					files : []
				};

				var http = new XMLHttpRequest(); 

				var cloudBase = editor.storage.imagesEndpoint;

				var url = cloudBase + "media/";
				url += "?t=" + (new Date().getTime());
				url = "http://cors.io/?u=" + escape(url);

				http.open("GET", url, true);
				http.onreadystatechange = function() {//Call a function when the state changes.
					if(http.readyState == 4) {
						if ((http.status > 199) && (http.status < 300)) { // accept any 2xx http status as 'OK';
							console.log(http.responseText);
							var data = JSON.parse(http.responseText);
							for (var i=0; i<data.items.length; i++) {
								result.images.push({
									"name" : data.items[i].code,
									"url"  : data.items[i].images.standard_resolution.url,
									"src"  : data.items[i].images.standard_resolution.url
								});
							}
						} else {
							// Failed?
						}
						callback(result);
					} 
				};
				http.send();
			};

/*			var normalSave = editor.storage.file.save;
			editor.storage.file.save = function(path, data, callback) {
				if (path.indexOf(editor.storage.imagesEndpoint) !== 0) {
					return normalSave(path, data, callback);
				}

				var baseUrl = editor.storage.imagesEndpoint.replace("res.cloudinary.com/", "api.cloudinary.com/v1_1/");
				var url = baseUrl + "image/upload";

				var http = new XMLHttpRequest();
				http.open("POST", url, true);
				http.onreadystatechange = function() {//Call a function when the state changes.
					if(http.readyState == 4) {
						if ((http.status > 199) && (http.status < 300)) { // accept any 2xx http status as 'OK';
							var result = JSON.parse(http.responseText);
							callback({"src" : editor.storage.imagesEndpoint + "image/upload/" + result.public_id});
						} else {
							callback({message : "SAVE FAILED: Could not store."});
						}
					} 
				};
				http.upload.onprogress = function (event) {
					if (event.lengthComputable) {
						var complete = (event.loaded / event.total * 100 | 0);
						var progress = document.querySelector("progress[data-simply-progress='" + path + "']");
						if (progress) {
							progress.value = progress.innerHTML = complete;
						}
					}
				};
				var tag = document.querySelector("[data-simply-images-tag]") ? document.querySelector("[data-simply-images-tag]").getAttribute("data-simply-images-tag") : "public";
				var preset = document.querySelector("[data-simply-images-preset]") ? document.querySelector("[data-simply-images-preset]").getAttribute("data-simply-images-preset") : "";

				var params = new FormData;

				params.append("tags", tag);
				params.append("upload_preset", preset);
				params.append("public_id", data.name.replace(/\.[^/.]+$/, ""));

				params.append("file", data);

				http.send(params);
			};
*/
		})();
	</script>
</body>
</html>