<section id="simply-symbol" class="simply-dialog">
	<div class="simply-toolbar">
		<ul class="simply-buttons">
			<li class='simply-right'><button data-simply-action="simply-dialog-close"><i class="fa fa-times"></i>Cancel</button></li>
			<li class='simply-right'><button data-simply-action="simply-dialog-fullscreen"><i class="fa fa-expand"></i>Full screen</button></li>
		</ul>
	</div>
	<div class="simply-dialog-body">
	</div>
</section>
<style type="text/css">
	#simply-symbol {
		top: 50%;
		height: 400px;
		max-height: 80%;
		margin-top: -200px;
		left: 50%;
		margin-left: -235px;
		background-color: #EEE;
		padding-top: 61px;
		box-sizing: border-box;
	}
	#simply-symbol.fullscreen {
		top: 0px;
		bottom: 0px;
		left: 0px;
		right: 0px;
		max-width: 100%;
		max-height: 100%;
		height: auto;
		width: auto;
		margin-left: 0px;
		margin-top: 0px;
	}
	#simply-symbol .simply-dialog-body {
		overflow-y: scroll;
		padding: 0px;
		width: 470px;
		padding-left: 2px;
	}
	#simply-symbol.fullscreen .simply-dialog-body {
		width: 100%;
	}
	#simply-symbol .simply-dialog-body button {
		border: 1px solid #eee;
		background-color: white;
		height: 50px;
		width: 50px;
		font-family: inherit;
		font-size: 20px;
	}
	@media (max-width: 481px) {
		#simply-symbol {
			top: 0px;
			bottom: 0px;
			left: 0px;
			right: 0px;
			max-width: 100%;
			max-height: 100%;
			height: auto;
			width: auto;
			margin-left: 0px;
			margin-top: 0px;
		}
		#simply-symbol [data-simply-action="simply-symbol-fullscreen"] {
			display: none;
		}
	}
</style>
<script>
	editor.plugins.symbol = {
		currentSel : null,
		currentField : null,
		dialog : {
			open : function() {
				editor.plugins.symbol.currentSel = vdSelectionState.get();
				editor.plugins.symbol.currentField = editor.node.getEditableField();
				editor.plugins.dialog.open(document.getElementById('simply-symbol'), editor.plugins.symbol.dialog.update);
			},
			update : function() {
				var parent = vdSelection.getNode(editor.plugins.symbol.currentSel);
				var styles = editor.node.getAllStyles(parent);

				var targetList = document.querySelector("#simply-symbol .simply-dialog-body");
				targetList.style.fontFamily = styles['font-family'];

				newHtml = '';
				for (var i=33; i<400; i++) {
					if (i == 173) {
						continue; // &shy
					}
					newHtml += "<button data-simply-action='simply-symbol-insert' data-value=" + i + ">&#" + i + ";</button>";
				}
				targetList.innerHTML = newHtml;
				window.setTimeout(function() {
					for (var i=400; i<2000; i++) {
						newHtml += "<button data-simply-action='simply-symbol-insert' data-value=" + i + ">&#" + i + ";</button>";
					}
					targetList.innerHTML = newHtml;
				}, 1);
			}
		}
	};

	editor.addAction("simply-symbol", editor.plugins.symbol.dialog.open);
	editor.addAction("simply-symbol-insert", function(el) {
		if (editor.plugins.symbol.currentField.hopeEditor) {
			var hopeEditor = editor.plugins.symbol.currentField.hopeEditor;

			vdSelectionState.restore(editor.plugins.symbol.currentSel);
			hopeEditor.selection.updateRange();

			var range = hopeEditor.selection.getRange();
			var charTyped = String.fromCharCode(el.dataset.value);

			if ( charTyped ) { // ignore non printable characters
				if ( range.length ) {
					hopeEditor.fragment = hopeEditor.fragment.delete(range);
				}
				hopeEditor.fragment = hopeEditor.fragment.insert(range.start, charTyped);
				hopeEditor.selection.move(1);
				hopeEditor.update();
			}
		} else {
			if (!editor.plugins.symbol.currentSel.collapsed) {
				vdSelectionState.restore(editor.plugins.symbol.currentSel);
				document.execCommand('delete'); // this is somehow needed to trick IE into breaking potential <P>'s into 2
			}
			vdSelection.setHTMLText(editor.plugins.symbol.currentSel, "&#" + el.dataset.value + ";");
		}
		editor.plugins.dialog.close();
	});

	var inserts = document.querySelectorAll(".simply-toolbar-section.simply-insert > ul");
	for (var i=0; i<inserts.length; i++) {
		var symbolLi = document.createElement("LI");
		var symbolButton = document.createElement("BUTTON");
		symbolButton.dataset.simplyAction = "simply-symbol";
		symbolButton.innerHTML = '<i class="fa fa-copyright"></i>Symbol';
		symbolLi.appendChild(symbolButton);
		inserts[i].appendChild(symbolLi);
	}
</script>